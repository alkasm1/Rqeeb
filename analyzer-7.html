<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RQEEB | Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ†</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #ff8800;
      --primary-dark: #e67700;
      --dark-bg: #0b0b0b;
      --card-bg: #1a1a1a;
      --text: #fff;
      --warning: #ffcc00;
      --danger: #ff3333;
      --success: #4CAF50;
      --box-left: #00cc66;
      --box-right: #ff4d4d;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(135deg, #070707, #0f0f0f);
      color: var(--text);
      font-family: 'Tajawal', 'Cairo', sans-serif;
      text-align: center;
      padding: 1.5rem;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    header {
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #222;
      position: relative;
    }
    
    h1 {
      font-size: 2.2rem;
      margin-bottom: 0.8rem;
      color: var(--primary);
      text-shadow: 0 0 15px rgba(255, 136, 0, 0.4);
      position: relative;
      display: inline-block;
    }
    
    h1:after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: var(--primary);
      border-radius: 2px;
    }
    
    .subtitle {
      color: #bbb;
      font-size: 1.1rem;
      max-width: 700px;
      margin: 0.8rem auto 0;
      line-height: 1.8;
    }
    
    .video-container {
      position: relative;
      width: 100%;
      max-width: 700px;
      margin: 2rem auto;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid #333;
    }
    
    video {
      width: 100%;
      display: block;
      background: #000;
    }
    
    .boxes {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    .box {
      position: absolute;
      width: 240px;
      height: 240px;
      border: 3px solid;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .box-left {
      top: 50px;
      left: 30px;
      border-color: var(--box-left);
      box-shadow: 0 0 20px rgba(0, 204, 102, 0.3);
    }
    
    .box-right {
      top: 50px;
      right: 30px;
      border-color: var(--box-right);
      box-shadow: 0 0 20px rgba(255, 77, 77, 0.3);
    }
    
    .box-label {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 0.3rem 1rem;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1rem;
    }
    
    .box-left .box-label {
      background: var(--box-left);
    }
    
    .box-right .box-label {
      background: var(--box-right);
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
    }
    
    button {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      box-shadow: 0 5px 15px rgba(230, 119, 0, 0.3);
      min-width: 250px;
    }
    
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 7px 20px rgba(230, 119, 0, 0.4);
    }
    
    button:disabled {
      background: #444;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      color: #777;
    }
    
    #confirmBtn {
      background: linear-gradient(135deg, #00cc66, #00b359);
      box-shadow: 0 5px 15px rgba(0, 179, 89, 0.3);
    }
    
    #confirmBtn:hover {
      box-shadow: 0 7px 20px rgba(0, 179, 89, 0.4);
    }
    
    .results-container {
      background: linear-gradient(145deg, #1a1a1a, #222);
      border-radius: 18px;
      padding: 2rem;
      margin: 2rem auto;
      max-width: 800px;
      border: 1px solid #333;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .results-header {
      font-size: 1.6rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      text-shadow: 0 0 8px rgba(255, 136, 0, 0.3);
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.2rem;
      margin-top: 1.5rem;
    }
    
    .metric {
      background: linear-gradient(145deg, #1e1e1e, #252525);
      padding: 1.2rem;
      border-radius: 15px;
      text-align: center;
      border: 1px solid #333;
      transition: all 0.3s ease;
    }
    
    .metric:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
    }
    
    .metric-value {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 0.8rem 0;
      color: var(--primary);
      text-shadow: 0 0 8px rgba(255, 136, 0, 0.3);
    }
    
    .metric-label {
      font-size: 1rem;
      color: #bbb;
    }
    
    .verdict {
      font-size: 1.5rem;
      font-weight: bold;
      margin-top: 2rem;
      padding: 1.5rem;
      border-radius: 15px;
      text-align: center;
      animation: pulse 2s infinite;
    }
    
    .verdict.safe {
      background: rgba(76, 175, 80, 0.15);
      color: var(--success);
      border: 2px solid var(--success);
    }
    
    .verdict.warning {
      background: rgba(255, 204, 0, 0.15);
      color: var(--warning);
      border: 2px solid var(--warning);
    }
    
    .verdict.danger {
      background: rgba(255, 51, 51, 0.15);
      color: var(--danger);
      border: 2px solid var(--danger);
    }
    
    .analysis-details {
      margin-top: 2rem;
      text-align: right;
      background: rgba(30, 30, 30, 0.5);
      padding: 1.5rem;
      border-radius: 15px;
      border: 1px solid #333;
    }
    
    .analysis-details h3 {
      margin-bottom: 1.2rem;
      color: var(--primary);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    
    .status {
      margin: 1rem 0;
      padding: 0.8rem;
      background: rgba(255, 136, 0, 0.1);
      border-radius: 10px;
      color: var(--primary);
      font-weight: bold;
      border: 1px solid var(--primary);
    }
    
    .instructions {
      background: rgba(30, 30, 30, 0.7);
      padding: 1.5rem;
      border-radius: 15px;
      margin: 2rem auto;
      max-width: 800px;
      border: 1px solid #333;
      text-align: right;
    }
    
    .instructions h3 {
      color: var(--primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    
    .instructions ol {
      padding-right: 1.5rem;
      margin-top: 1rem;
    }
    
    .instructions li {
      margin-bottom: 0.8rem;
      line-height: 1.7;
    }
    
    footer {
      margin-top: 3rem;
      font-size: 1rem;
      color: #777;
      padding-top: 2rem;
      border-top: 1px solid #333;
      line-height: 1.8;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .hidden {
      display: none;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .video-container {
        max-width: 100%;
      }
      
      .box {
        width: 180px;
        height: 180px;
      }
      
      .box-left {
        top: 30px;
        left: 15px;
      }
      
      .box-right {
        top: 30px;
        right: 15px;
      }
      
      .controls {
        flex-direction: column;
        align-items: center;
      }
      
      button {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-camera"></i> Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ†</h1>
      <p class="subtitle">
        Ù†Ø¸Ø§Ù… Ù…ØªØ·ÙˆØ± Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
      </p>
    </header>

    <div class="instructions">
      <h3><i class="fas fa-info-circle"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</h3>
      <ol>
        <li>Ø£Ù…Ø³Ùƒ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø®Ø¶Ø± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø´ÙƒÙˆÙƒ ÙÙŠÙ‡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø­Ù…Ø±</li>
        <li>ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† ÙˆØ¸Ù‡ÙˆØ±Ù‡Ù…Ø§ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª</li>
        <li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´ÙƒÙ„ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰" Ù„Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚</li>
        <li>Ø§Ù‚Ø±Ø£ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØªØµØ±Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØµÙŠØ§Øª</li>
        <li>Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "ØªØ­Ù‚Ù‚ ÙØ¹Ù„ÙŠ" Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</li>
      </ol>
      <p class="status" id="cameraStatus">âŒ› Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</p>
    </div>

    <div class="video-container">
      <video id="video" autoplay playsinline></video>
      <div class="boxes">
        <div class="box box-left">
          <div class="box-label">Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ</div>
        </div>
        <div class="box box-right">
          <div class="box-label">Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø´ÙƒÙˆÙƒ ÙÙŠÙ‡</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button onclick="analyze()" id="analyzeBtn">
        <i class="fas fa-search"></i> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´ÙƒÙ„ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
      </button>
      <button id="confirmBtn" onclick="confirmMatch()" class="hidden">
        <i class="fas fa-check-circle"></i> ØªØ­Ù‚Ù‚ ÙØ¹Ù„ÙŠ
      </button>
    </div>

    <div class="results-container hidden" id="resultsContainer">
      <div class="results-header">
        <i class="fas fa-chart-bar"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„
      </div>
      <div id="results"></div>
    </div>

    <footer>
      <p><i class="fas fa-code"></i> Ù…: Ø±Ø£ÙØª Ø¹Ù…Ø± â€” RQEEB Project Â© 2025 | Ø§Ù„Ø¥ØµØ¯Ø§Ø± 4.0 Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</p>
      <p><i class="fas fa-info-circle"></i> Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ØªØ²ÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</p>
    </footer>
  </div>

  <script>
    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const video = document.getElementById("video");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const confirmBtn = document.getElementById("confirmBtn");
    const resultsContainer = document.getElementById("resultsContainer");
    const resultsDiv = document.getElementById("results");
    const cameraStatus = document.getElementById("cameraStatus");
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => {
        video.srcObject = stream;
        cameraStatus.innerHTML = '<i class="fas fa-check-circle"></i> Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø© - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡';
        cameraStatus.style.color = '#00cc66';
        cameraStatus.style.borderColor = '#00cc66';
      })
      .catch(err => {
        cameraStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ - ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª';
        cameraStatus.style.color = '#ff3333';
        cameraStatus.style.borderColor = '#ff3333';
        analyzeBtn.disabled = true;
      });

    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ†
    function analyze() {
      if (video.readyState < 2) {
        showError("ğŸ“· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ø¨Ø¹Ø¯");
        return;
      }

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±
      resultsContainer.classList.remove("hidden");
      confirmBtn.classList.add("hidden");
      resultsDiv.innerHTML = `
        <div class="status">
          <i class="fas fa-cogs"></i> Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ†...
        </div>
      `;

      // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      setTimeout(() => {
        try {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          const boxW = 240, boxH = 240;
          const left = ctx.getImageData(30, 50, boxW, boxH);
          const right = ctx.getImageData(canvas.width - boxW - 30, 50, boxW, boxH);

          const shapeScore = estimateShapeMatch(left, right);
          if (shapeScore < 50) {
            confirmBtn.classList.add("hidden");
            resultsDiv.innerHTML = `
              <div class="metric">
                <div class="metric-label">Ù†Ø³Ø¨Ø© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ</div>
                <div class="metric-value">${shapeScore.toFixed(1)}%</div>
              </div>
              <div class="verdict danger">
                <i class="fas fa-times-circle"></i> Ù†Ø³Ø¨Ø© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ (50%) âŒ
              </div>
              <div class="analysis-details">
                <h3><i class="fas fa-info-circle"></i> Ø§Ù„ØªÙˆØµÙŠØ§Øª:</h3>
                <p>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª</p>
                <p>â€¢ ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† ÙˆØ¸Ù‡ÙˆØ±Ù‡Ù…Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                <p>â€¢ Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p>
              </div>
            `;
            return;
          }

          const colorScore = compareHSVSimilarity(left.data, right.data);
          const texture1 = analyzeTexture(left);
          const texture2 = analyzeTexture(right);
          const diffAvg = Math.abs(texture1.avg - texture2.avg);
          const diffDev = Math.abs(texture1.dev - texture2.dev);
          const textureScore = 100 - Math.min((diffAvg + diffDev) / 2, 100);

          const decision = getScientificDecision(colorScore, textureScore);

          // Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
          resultsDiv.innerHTML = `
            <div class="metrics-grid">
              <div class="metric">
                <div class="metric-label">ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ</div>
                <div class="metric-value">${shapeScore.toFixed(1)}%</div>
              </div>
              
              <div class="metric">
                <div class="metric-label">ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ø£Ù„ÙˆØ§Ù† (HSV)</div>
                <div class="metric-value">${colorScore.toFixed(1)}%</div>
              </div>
              
              <div class="metric">
                <div class="metric-label">ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ù†Ø³ÙŠØ¬</div>
                <div class="metric-value">${textureScore.toFixed(1)}%</div>
              </div>
              
              <div class="metric">
                <div class="metric-label">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                <div class="metric-value">${decision.finalScore}%</div>
              </div>
            </div>
            
            <div class="verdict ${decision.score >= 85 ? 'safe' : decision.score >= 70 ? 'warning' : 'danger'}">
              <i class="fas fa-${decision.score >= 85 ? 'check-circle' : decision.score >= 70 ? 'exclamation-triangle' : 'times-circle'}"></i>
              ${decision.verdict}
            </div>
            
            <div class="analysis-details">
              <h3><i class="fas fa-microscope"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</h3>
              <p>â€¢ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù„ÙˆÙ†: ${(100 - colorScore).toFixed(1)}%</p>
              <p>â€¢ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ù†Ø³ÙŠØ¬ Ø§Ù„ÙˆØ±Ù‚: ${(100 - textureScore).toFixed(1)}%</p>
              <p>â€¢ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ: ${(100 - shapeScore).toFixed(1)}%</p>
              ${decision.score >= 85 ? 
                '<p>âœ… Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Ù† Ù…ØªØ·Ø§Ø¨Ù‚Ø§Ù† Ø¨Ù†Ø³Ø¨Ø© Ø¹Ø§Ù„ÙŠØ© - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ</p>' : 
                decision.score >= 70 ? 
                '<p>âš ï¸ ØªØ·Ø§Ø¨Ù‚ Ø¬Ø²Ø¦ÙŠ - ÙŠÙˆØµÙ‰ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙŠØ¯ÙˆÙŠ</p>' : 
                '<p>âŒ ØªØ·Ø§Ø¨Ù‚ Ù…Ù†Ø®ÙØ¶ - Ø§Ø­ØªÙ…Ø§Ù„ ØªØ²ÙˆÙŠØ± Ù…Ø±ØªÙØ¹</p>'}
            </div>
          `;

          // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¬ÙŠØ¯Ø©
          if (decision.score >= 70) {
            confirmBtn.classList.remove("hidden");
          }

        } catch (error) {
          showError("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: " + error.message);
        }
      }, 500);
    }

    // ØªØ­Ù„ÙŠÙ„ HSV Ø¨Ø¯Ù‚Ø©
    function compareHSVSimilarity(data1, data2) {
      function rgbToHsv(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        const max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, v = max;
        const d = max - min;
        s = max === 0 ? 0 : d / max;
        if (max === min) h = 0;
        else {
          switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }
        return [h * 360, s * 100, v * 100];
      }

      let totalH1 = 0, totalS1 = 0, totalV1 = 0;
      let totalH2 = 0, totalS2 = 0, totalV2 = 0;
      const pixels = data1.length / 4;

      for (let i = 0; i < data1.length; i += 4) {
        const [h1, s1, v1] = rgbToHsv(data1[i], data1[i+1], data1[i+2]);
        const [h2, s2, v2] = rgbToHsv(data2[i], data2[i+1], data2[i+2]);
        totalH1 += h1; totalS1 += s1; totalV1 += v1;
        totalH2 += h2; totalS2 += s2; totalV2 += v2;
      }

      const avgH1 = totalH1 / pixels, avgS1 = totalS1 / pixels, avgV1 = totalV1 / pixels;
      const avgH2 = totalH2 / pixels, avgS2 = totalS2 / pixels, avgV2 = totalV2 / pixels;

      const diffH = Math.abs(avgH1 - avgH2) / 360 * 40;
      const diffS = Math.abs(avgS1 - avgS2) / 100 * 30;
      const diffV = Math.abs(avgV1 - avgV2) / 100 * 30;
      const score = 100 - (diffH + diffS + diffV);
      return Math.max(0, Math.min(100, score));
    }

    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ø³ÙŠØ¬
    function analyzeTexture(imageData) {
      const data = imageData.data;
      let sum = 0;
      const values = [];
      for (let i = 0; i < data.length; i += 4) {
        const g = (data[i] + data[i+1] + data[i+2]) / 3;
        values.push(g);
        sum += g;
      }
      const avg = sum / values.length;
      const dev = Math.sqrt(values.reduce((acc, val) => acc + Math.pow(val - avg, 2), 0) / values.length);
      return { avg, dev };
    }

    // ØªÙ‚Ø¯ÙŠØ± ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø´ÙƒÙ„
    function estimateShapeMatch(img1, img2) {
      let matched = 0;
      const pixels = img1.data.length / 4;
      for (let i = 0; i < img1.data.length; i += 4) {
        const g1 = (img1.data[i] + img1.data[i+1] + img1.data[i+2]) / 3;
        const g2 = (img2.data[i] + img2.data[i+1] + img2.data[i+2]) / 3;
        if (Math.abs(g1 - g2) < 30) matched++;
      }
      return matched / pixels * 100;
    }

    // Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø¹Ù„Ù…ÙŠ
    function getScientificDecision(color, texture, threshold = 85) {
      const score = (color * 0.6) + (texture * 0.4);
      let verdict = "";
      
      if (score >= 90) {
        verdict = "âœ… ØªØ·Ø§Ø¨Ù‚ Ø¹Ù„Ù…ÙŠ Ø¹Ø§Ù„ÙŠ - Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Ù† Ø£ØµÙ„ÙŠØ§Ù†";
      } else if (score >= 85) {
        verdict = "âœ… ØªØ·Ø§Ø¨Ù‚ Ø¹Ù„Ù…ÙŠ Ù…Ø¤ÙƒØ¯ - Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Ù† Ù…ØªØ·Ø§Ø¨Ù‚Ø§Ù†";
      } else if (score >= 75) {
        verdict = "âš ï¸ ØªØ·Ø§Ø¨Ù‚ Ø¹Ù„Ù…ÙŠ Ø¬Ø²Ø¦ÙŠ - ÙŠÙˆØµÙ‰ Ø¨ÙØ­Øµ ÙŠØ¯ÙˆÙŠ";
      } else if (score >= 65) {
        verdict = "âš ï¸ ØªØ·Ø§Ø¨Ù‚ Ù…Ù†Ø®ÙØ¶ - Ø§Ø­ØªÙ…Ø§Ù„ ØªØ²ÙˆÙŠØ± Ù…ØªÙˆØ³Ø·";
      } else {
        verdict = "âŒ ØªØ·Ø§Ø¨Ù‚ Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ - ØªØ²ÙˆÙŠØ± Ù…Ø­ØªÙ…Ù„";
      }
      
      return {
        score: score,
        finalScore: score.toFixed(1),
        verdict: verdict
      };
    }

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    function confirmMatch() {
      resultsDiv.innerHTML += `
        <div class="verdict safe">
          <i class="fas fa-check-circle"></i> ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­ - Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…ØªØ·Ø§Ø¨Ù‚Ø©
        </div>
        <div class="analysis-details">
          <h3><i class="fas fa-clipboard-check"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…ØªØ¨Ø¹Ø©:</h3>
          <p>â€¢ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
          <p>â€¢ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø±Ù‚Ù…ÙŠ Ù„Ù„Ù†ØªØ§Ø¦Ø¬</p>
          <p>â€¢ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚</p>
        </div>
      `;
      
      // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯
      analyzeBtn.disabled = true;
      confirmBtn.disabled = true;
    }

    // Ø¹Ø±Ø¶ Ø®Ø·Ø£
    function showError(message) {
      resultsContainer.classList.remove("hidden");
      resultsDiv.innerHTML = `
        <div class="verdict danger">
          <i class="fas fa-exclamation-circle"></i> ${message}
        </div>
        <div class="analysis-details">
          <h3><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:</h3>
          <p>â€¢ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
          <p>â€¢ Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
          <p>â€¢ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªÙ†Ø¯ÙŠÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
        </div>
      `;
    }
  </script>
</body>
</html>
