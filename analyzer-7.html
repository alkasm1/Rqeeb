<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تحليل العملات المعدنية – RQEEB</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #111; color: #ffa500; text-align: center; padding: 2rem; }
    canvas { border: 1px solid #444; margin-top: 1rem; }
    .result { margin-top: 2rem; font-size: 1.2rem; background: #222; padding: 1rem; border-radius: 10px; }
    .score { font-size: 2rem; font-weight: bold; margin: 1rem 0; }
    .safe { color: #4CAF50; }
    .warning { color: #ffcc00; }
    .danger { color: #ff3333; }
  </style>
</head>
<body>

  <h2>تحليل العملات المعدنية – RQEEB</h2>
  <p>ارفع صورة تحتوي على عملتين بجانب بعضهما لتحليل الفرق بينهما.</p>

  <input type="file" accept="image/*" id="coinImage" onchange="analyzeCoins()" />
  <canvas id="canvas" width="600" height="300"></canvas>

  <div class="result" id="resultBox">
    <div class="score" id="scoreText">--%</div>
    <div id="verdictText">بانتظار التحليل...</div>
  </div>

  <script>
    function analyzeCoins() {
      const file = document.getElementById('coinImage').files[0];
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const reader = new FileReader();

      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          const halfWidth = canvas.width / 2;
          const height = canvas.height;

          const leftData = ctx.getImageData(0, 0, halfWidth, height);
          const rightData = ctx.getImageData(halfWidth, 0, halfWidth, height);

          const leftScore = extractFeatures(leftData);
          const rightScore = extractFeatures(rightData);

          const diff = Math.abs(leftScore - rightScore);
          let similarity = Math.max(0, 100 - diff * 100);
          similarity = Math.round(similarity);

          const scoreText = document.getElementById('scoreText');
          const verdictText = document.getElementById('verdictText');
          const resultBox = document.getElementById('resultBox');

          scoreText.textContent = similarity + "%";

          if (similarity >= 90) {
            verdictText.textContent = "✅ تطابق تام – العملتان أصليتان";
            resultBox.className = "result safe";
          } else if (similarity >= 70) {
            verdictText.textContent = "⚠️ تطابق جزئي – تحقق يدوي موصى به";
            resultBox.className = "result warning";
          } else {
            verdictText.textContent = "❌ اختلاف كبير – تزوير محتمل";
            resultBox.className = "result danger";
          }
        };
        img.src = e.target.result;
      };
      if (file) reader.readAsDataURL(file);
    }

    function extractFeatures(imageData) {
      const data = imageData.data;
      let brightness = 0;
      let texture = 0;
      for (let i = 4; i < data.length; i += 4) {
        const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
        brightness += gray;
        const prevGray = (data[i - 4] + data[i - 3] + data[i - 2]) / 3;
        texture += Math.abs(gray - prevGray);
      }
      brightness /= (data.length / 4);
      texture /= (data.length / 4);
      return brightness * 0.6 + texture * 0.4;
    }
  </script>

</body>
</html>
